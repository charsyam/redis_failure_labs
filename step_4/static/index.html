<!DOCTYPE html>
<html>
<head>
  <title>ê³µì§€ì‚¬í•­</title>
</head>
<body>
  <h1>ğŸ“¢ ê³µì§€ì‚¬í•­</h1>

  <div>
    <input id="new_title" placeholder="ì œëª© ì…ë ¥"><br>
    <textarea id="new_body" rows="4" cols="50" placeholder="ë‚´ìš© ì…ë ¥"></textarea><br>
    <button onclick="postNotice()">ë“±ë¡</button>
  </div>

  <hr>
  <div>
    <button onclick="prevPage()">ì´ì „</button>
    <button onclick="nextPage()">ë‹¤ìŒ</button>
    <span>í˜ì´ì§€: <span id="current_page">1</span></span>
  </div>

<p>ì¡°íšŒ ì‹œê°„: <span id="query_time"></span> ms</p>
  <ul id="notice_list"></ul>

  <script>
    let currentPage = 1;

    async function loadNotices(page) {
  const res = await fetch(`http://localhost:8000/notices?page=${page}`);
  const data = await res.json();
  currentPage = data.page;
  document.getElementById("current_page").innerText = currentPage;

  const list = document.getElementById("notice_list");
  list.innerHTML = "";
  data.notices.forEach(n => {
    const li = document.createElement("li");
    li.innerHTML = `<a href="#" onclick="loadDetail(${n.id})"><b>${n.title}</b></a>`;
    list.appendChild(li);
  });
document.getElementById("query_time").innerText = data.total_elapsed_ms;
}

async function loadDetail(id) {
  const res = await fetch(`http://localhost:8000/notice/${id}`);
  const data = await res.json();
  alert(`ì œëª©: ${data.title}\n\në‚´ìš©:\n${data.body}`);
}

async function postNotice() {
  const title = document.getElementById("new_title").value;
  const body = document.getElementById("new_body").value;

  if (!title || !body) {
    alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  await fetch("http://localhost:8000/notice", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ title, body })
  });

  // ì…ë ¥ ì´ˆê¸°í™” ë° ìµœì‹  ê³µì§€ ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
  document.getElementById("new_title").value = "";
  document.getElementById("new_body").value = "";
  loadNotices(1);
}

    function nextPage() {
      loadNotices(currentPage + 1);
    }

    function prevPage() {
      if (currentPage > 1) loadNotices(currentPage - 1);
    }

    loadNotices(1);
  </script>
</body>
</html>

