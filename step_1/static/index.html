<!DOCTYPE html>
<html>
<head>
  <title>Redis ì¥ì•  ì‹¤ìŠµ</title>
</head>
<body>
  <h1>Redis ì¥ì•  ì‹¤ìŠµ ì‹œìŠ¤í…œ</h1>

  <h2>1. ìœ ì € ë“±ë¡</h2>
  <input id="user_id" placeholder="User ID">
  <button onclick="register()">ë“±ë¡</button>

  <h2>2. ë©”ì‹œì§€ ì „ì†¡</h2>
  <input id="msg_content" placeholder="Message">
  <button onclick="send()">ë³´ë‚´ê¸°</button>

  <h2>3. ê´€ë¦¬ì ê²€ìƒ‰ (ì¥ì•  ìœ ë„)</h2>
  <input id="search_prefix" placeholder="Prefix">
  <button onclick="search()">ê²€ìƒ‰</button>
  <p id="loading" style="display:none;">ğŸ”„ ê²€ìƒ‰ ì¤‘...</p>
  <ul id="result_list"></ul>

  <script>
    function register() {
      const user = document.getElementById("user_id").value;
      fetch("/register?user_id=" + user, { method: "POST" })
        .then(() => alert("âœ… ìœ ì € ë“±ë¡ ì™„ë£Œ"));
    }

    function send() {
      const user = document.getElementById("user_id").value;
      const content = document.getElementById("msg_content").value;
      fetch("/send_message", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: user, content: content })
      }).then(() => alert("âœ… ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œ"));
    }

    function search() {
      const prefix = document.getElementById("search_prefix").value;
      document.getElementById("loading").style.display = "block";
      document.getElementById("result_list").innerHTML = '';

      const start = performance.now();

fetch("/admin/search_messages?prefix=" + prefix)
    .then(res => res.json())
    .then(data => {
      const end = performance.now();  // â± ìš”ì²­ ì¢…ë£Œ ì‹œê°
      const duration = Math.round(end - start);

      document.getElementById("loading").style.display = "none";
      const ul = document.getElementById("result_list");

      // ì‘ë‹µ ì‹œê°„ ì¶”ê°€
      const info = document.createElement('li');
      info.innerHTML = `<strong>â± ì‘ë‹µ ì‹œê°„: ${duration}ms</strong>`;
      ul.appendChild(info);

      // ê²°ê³¼ ì¶œë ¥
      for (const [key, value] of Object.entries(data)) {
        const li = document.createElement('li');
        li.textContent = `[${key}] â†’ ${value}`;
        ul.appendChild(li);
      }
    })
    .catch(err => {
      document.getElementById("loading").style.display = "none";
      alert("âŒ ì˜¤ë¥˜ ë°œìƒ: " + err.message);
    });
}
</script>
</body>
</html>
